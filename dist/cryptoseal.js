!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.cryptoSeal=r():e.cryptoSeal=r()}(self,(()=>(()=>{"use strict";var e={397:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.sealBuffer=y,r.sealString=f,r.sealValue=async function(e,r,t){return f(JSON.stringify(e),r,t)},r.unsealBuffer=h,r.unsealString=p,r.unsealValue=async function(e,r,t){const n=await p(e,r,t);return JSON.parse(n)};var n=t(897);function a(e,r){if(!e)throw new Error(r||"")}function o(e){return(new TextEncoder).encode(e)}const i=10,s="AES-256-CBC-HMAC-SHA-256",u=["AES-256-CBC-HMAC-SHA-256"];function c(e){return{AES:"AES-256-CBC-HMAC-SHA-256","AES-CBC":"AES-256-CBC-HMAC-SHA-256","AES-GCM":"AES-256-GCM"}[e]||e}async function f(e,r,t){if("string"!=typeof e)throw new Error("Invalid 'data'");return y(o(e),r,t)}function l(e){return"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype}async function y(e,r,t){if(!(e instanceof Uint8Array))throw new Error("Invalid 'data'.");if(void 0===t&&(t={}),!l(t))throw new Error("'opts' must be a plain object.");if(t.cipher=t.cipher||s,!u.includes(t.cipher))throw new Error("Invalid 'opts.cipher'.");const o=await async function(){const e=new Uint8Array(16);return await(0,n.getRandomValues)(e),e}(),i=await w(o,r,t.kdfRounds,t.rawKey);if(t.cipher=c(t.cipher),"AES-256-CBC-HMAC-SHA-256"===t.cipher)return async function(e,r,t){const{cipherSalt:o,cipherEncKey:i,cipherAuthKey:s}=await d(r),u=new Uint8Array(await n.subtle.encrypt({name:"AES-CBC",iv:o},i,e)),c=new Uint8Array(16+u.byteLength+32);c.set(t,0),c.set(u,16);const f=new Uint8Array(await n.subtle.sign("HMAC",s,c.subarray(0,16+u.byteLength)));return a(32===f.byteLength),c.set(f,16+u.byteLength),c}(e,i,o);throw new Error("UNREACHABLE")}async function p(e,r,t){const n=await h(e,r,t);return function(e){return(new TextDecoder).decode(e)}(new Uint8Array(n))}async function h(e,r,t){if(!(e instanceof Uint8Array))throw new Error("Invalid 'data'.");if(void 0===t&&(t={}),!l(t))throw new Error("'opts' must be a plain object.");if(t.cipher=t.cipher||s,!u.includes(t.cipher))throw new Error("Invalid 'opts.cipher'.");if(t.cipher=c(t.cipher),"AES-256-CBC-HMAC-SHA-256"===t.cipher)return async function(e,r,t){if(e.byteLength<48)throw new Error("Invalid 'data'.");const o=e.subarray(0,16),i=e.subarray(0,e.byteLength-32),s=e.subarray(e.byteLength-32);a(32===s.length);const u=await w(o,r,t.kdfRounds,t.rawKey),{cipherSalt:c,cipherEncKey:f,cipherAuthKey:l}=await d(u);if(!0!==await n.subtle.verify("HMAC",l,s,i))throw new Error("Invalid 'data' (authentication tag verification failed).");const y=e.subarray(16,e.byteLength-32);return n.subtle.decrypt({name:"AES-CBC",iv:c},f,y)}(e,r,t);throw new Error("UNREACHABLE")}async function d(e){return{cipherSalt:await async function(e,r){return a(!0),new Uint8Array(await n.subtle.deriveBits({name:"HKDF",hash:"SHA-256",info:o(r),salt:new ArrayBuffer(16)},e,128))}(e,"/v1/seal/AES-256-CBC-HMAC-SHA-256/salt"),cipherEncKey:await b(e,"/v1/seal/AES-256-CBC-HMAC-SHA-256/enckey",{name:"AES-CBC",length:256},["encrypt","decrypt"]),cipherAuthKey:await b(e,"/v1/seal/AES-256-CBC-HMAC-SHA-256/authkey",{name:"HMAC",hash:"SHA-256",length:256},["sign","verify"])}}async function w(e,r,t,s){if(r){if(void 0!==s)throw new Error("You can either provide a 'passphrase' or an 'opts.rawKey', not both.");if("string"==typeof r&&(r=o(r)),!(r instanceof Uint8Array))throw new Error("Invalid 'passphrase'.");if((t=Math.floor(t||i))in[1/0,NaN]||t<=0)throw new Error("Invalid 'rounds'.");return async function(e,r,t){const o=await n.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),i=await n.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:r,iterations:t},o,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),s=await n.subtle.exportKey("raw",i);return a(32===s.byteLength),n.subtle.importKey("raw",s,{name:"HKDF",hash:"SHA-256"},!1,["deriveKey","deriveBits"])}(r,e,t)}if(s){if(void 0!==r)throw new Error("You can either provide a 'passphrase' or an 'opts.rawKey', not both.");if(!(s instanceof Uint8Array))throw new Error("Invalid 'opts.rawKey'.");a(!1,"UNIMPLEMENTED")}throw new Error("Either 'passphrase' or 'opts.rawKey' must be provided.")}async function b(e,r,t,i){return a(r.length>0),n.subtle.deriveKey({name:"HKDF",hash:"SHA-256",info:o(r),salt:new ArrayBuffer(16)},e,t,!0,i)}},897:(e,r,t)=>{t.r(r),t.d(r,{default:()=>s,getRandomValues:()=>i,randomUUID:()=>o,subtle:()=>a});const n=globalThis.crypto,a=n.subtle,o=()=>n.randomUUID(),i=e=>n.getRandomValues(e),s={randomUUID:o,getRandomValues:i,subtle:a}}},r={};function t(n){var a=r[n];if(void 0!==a)return a.exports;var o=r[n]={exports:{}};return e[n](o,o.exports,t),o.exports}t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"sealBuffer",{enumerable:!0,get:function(){return r.sealBuffer}}),Object.defineProperty(e,"sealString",{enumerable:!0,get:function(){return r.sealString}}),Object.defineProperty(e,"sealValue",{enumerable:!0,get:function(){return r.sealValue}}),Object.defineProperty(e,"unsealBuffer",{enumerable:!0,get:function(){return r.unsealBuffer}}),Object.defineProperty(e,"unsealString",{enumerable:!0,get:function(){return r.unsealString}}),Object.defineProperty(e,"unsealValue",{enumerable:!0,get:function(){return r.unsealValue}});var r=t(397)})(),n})()));
//# sourceMappingURL=cryptoseal.js.map